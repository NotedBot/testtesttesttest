<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotedBot │ 7TV <span id="paint-name"></span> Paint</title>
    <link rel="icon" href="img/notedbotlogo.png" type="image/png">
    <link rel="stylesheet" href="./ressourcen/styles.css">
    <script src="https://cdn.rawgit.com/jnordberg/gif.js/master/dist/gif.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="logo">
            <a href="home.html"><img src="img/notedbot.gif" alt="NotedBot Logo"></a>
        </div>
        <div class="navigation">
            <h1 id="title"><img src="img/notedbotlogo.png" alt="NotedBot Logo"> <span>NotedBot 7TV Paint </span> <span id="paint-name"></span></h1>
            <ul>
                <li><a onclick="alert('Du bist doch schon auf der Seite?')">Home</a></li>
                <li><a href="commands.html">Commands</a></li>
            </ul>
        </div>
        <div class="samples">
            <div id="sample1" class="paint-text">Wydios</div>
            <div id="sample2" class="paint-text">██████</div>
        </div>
    </div>
    
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        
        const getRandomColor = () => Math.floor(Math.random() * 16777215) | 0xFF000000;

        const paintData = {
            id: urlParams.get('id') || "01GZBZ2T0R0005K1FJYZ11J7EZ",
            name: urlParams.get('name') || "Tropical",
            function: "LINEAR_GRADIENT",
            angle: 90,
            repeat: false,
            image_url: "",
            stops: [
                { at: 0, color: getRandomColor() },
                { at: 0.5, color: getRandomColor() },
                { at: 1, color: getRandomColor() }
            ],
            shadows: [
                { x_offset: 0, y_offset: 0, radius: 4, color: getRandomColor() },
                { x_offset: 0, y_offset: 0, radius: 0.1, color: getRandomColor() }
            ]
        };

        document.getElementById("paint-name").textContent = paintData.name;

        const convertToHex = (color) => {
            const normalizedColor = color >>> 0;
            return `#${normalizedColor.toString(16).padStart(8, '0').slice(2)}`;
        };

        const createGradientStops = (stops) => {
            return stops.map(stop => `${convertToHex(stop.color)} ${stop.at * 100}%`).join(', ');
        };

        const applyGradient = (type, direction, stops, repeat) => {
            return `${repeat ? `repeating-${type}` : type}(${direction}, ${stops})`;
        };

        const applyShadows = (shadows) => {
            return shadows.map(shadow => {
                const colorString = convertToHex(shadow.color);
                return `drop-shadow(${shadow.x_offset}px ${shadow.y_offset}px ${shadow.radius}px ${colorString})`;
            }).join(' ');
        };

        const paintElem1 = document.getElementById("sample1");
        const paintElem2 = document.getElementById("sample2");

        if (paintData.function === 'LINEAR_GRADIENT' && paintData.stops?.length) {
            const gradientStops = createGradientStops(paintData.stops);
            const gradientDirection = `${paintData.angle}deg`;
            paintElem1.style.backgroundImage = applyGradient('linear-gradient', gradientDirection, gradientStops, paintData.repeat);
            paintElem2.style.backgroundImage = applyGradient('linear-gradient', gradientDirection, gradientStops, paintData.repeat);
        } else if (paintData.function === 'RADIAL_GRADIENT' && paintData.stops?.length) {
            const gradientStops = createGradientStops(paintData.stops);
            paintElem1.style.backgroundImage = applyGradient('radial-gradient', '', gradientStops, paintData.repeat);
            paintElem2.style.backgroundImage = applyGradient('radial-gradient', '', gradientStops, paintData.repeat);
        } else if (paintData.function === 'URL' && paintData.image_url) {
            const imageUrl = paintData.image_url.replace('/1x.', '/3x.');
            paintElem1.style.backgroundImage = `url('${imageUrl}')`;
            paintElem2.style.backgroundImage = `url('${imageUrl}')`;
        }

        if (paintData.shadows?.length) {
            paintElem1.style.filter = applyShadows(paintData.shadows);
            paintElem2.style.filter = applyShadows(paintData.shadows);
        } else {
            paintElem1.style.filter = '';
            paintElem2.style.filter = '';
        }
    </script>
</body>
</html>
